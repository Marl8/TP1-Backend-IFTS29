extends ../layout

block content
    h2.mb-4 Editar Pedido

    a.btn.btn-secondary.mb-3.ms-2(href="/delivery") ← Volver al menú
    
    if error
        p.text-danger.mt-2 #{error}

    // Form para buscar el pedido por ID
    form(method="get" action="/delivery/update")
        .mb-3.d-flex.flex-column
            label.form-label(for="id") Ingresa el ID del pedido a editar
            input.form-control(type="text", name="id", id="id", required value=query.id || '')
            button.btn.btn-primary.mt-3.w-50.mx-auto(type="submit") Buscar

    if delivery
        hr
        h3.mb-3 Pedido ID: #{delivery._id}
        
        form(method="post" action=`/delivery/update/${delivery._id}`)
            
            .mb-3
                label.form-label Cliente
                input.form-control(type="text", value=delivery.customerId ? delivery.customerId.name : 'N/A', readonly)

            .mb-3
                label.form-label(for="estado") Estado
                select.form-select(name="estado", id="estado", required)
                    option(value="preparing" selected=delivery.status === 'preparing') Preparando
                    option(value="dispatched" selected=delivery.status === 'dispatched') Despachado
                    option(value="delivered" selected=delivery.status === 'delivered') Entregado
            .mb-3
                label.form-label Ítems (Solo lectura)
                textarea.form-control(rows="5", readonly)= JSON.stringify(delivery.items, null, 2)
            
            .mb-3
                label.form-label(for="total") Total ($)
                input.form-control(type="number", name="total", id="total", value=delivery.total)
            
            .mb-3
                label.form-label(for="repartidor") Repartidor asignado
                select.form-select(name="repartidor" id="repartidor")
                    option(value="" selected=!delivery.assignedRiderId) -- Sin asignar --
                    each rider in riders
                        option(value=rider._id selected=(delivery.assignedRiderId && delivery.assignedRiderId._id.toString() === rider._id.toString())) #{rider.name} (#{rider.vehicle})
            
            button.btn.btn-success(type="submit") Guardar Cambios
            a.btn.btn-secondary.ms-2(href="/delivery") Cancelar

    else if query.id
        p.text-warning.mt-2 No se encontró el pedido con ID #{query.id}.